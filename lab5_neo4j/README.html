<!DOCTYPE html><html><head>
      <title>README</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\tomek\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.5.1\node_modules\@shd101wyy\mume\dependencies\katex\katex.min.css">
      
      

      
      
      
      
      
      
      

      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <h1 class="mume-header" id="neo4j">Neo4j</h1>

<h2 class="mume-header" id="tomasz-zawadzki">Tomasz Zawadzki</h2>

<h5 class="mume-header" id="1-zainstalowa%C4%87-serwer-neo4j-lokalnie-httpsneo4jcomdownload-centerreleases">1. Zainstalowa&#x107; serwer neo4j lokalnie (<a href="https://neo4j.com/download-center/#releases">https://neo4j.com/download-center/#releases</a>).</h5>

<p>Zainstalowa&#x142;em Neo4j 3.5.12, Neo4j Browser 4.0.1.</p>
<h5 class="mume-header" id="2-wgra%C4%87-baz%C4%99">2. Wgra&#x107; baz&#x119;:</h5>

<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">LOAD</span> CSV <span class="token keyword">WITH</span> HEADERS
<span class="token keyword">FROM</span> <span class="token string">&apos;https://neo4j.com/docs/cypher-manual/3.5/csv/query-tuning/movies.csv&apos;</span> <span class="token keyword">AS</span> line
<span class="token keyword">MERGE</span> <span class="token punctuation">(</span>m:Movie { title: line<span class="token punctuation">.</span>title }<span class="token punctuation">)</span>
<span class="token keyword">ON</span> <span class="token keyword">CREATE</span> <span class="token keyword">SET</span> m<span class="token punctuation">.</span>released <span class="token operator">=</span> toInteger<span class="token punctuation">(</span>line<span class="token punctuation">.</span>released<span class="token punctuation">)</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>tagline <span class="token operator">=</span> line<span class="token punctuation">.</span>tagline
</pre><pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">LOAD</span> CSV <span class="token keyword">WITH</span> HEADERS
<span class="token keyword">FROM</span> <span class="token string">&apos;https://neo4j.com/docs/cypher-manual/3.5/csv/query-tuning/actors.csv&apos;</span> <span class="token keyword">AS</span> line
<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>m:Movie { title: line<span class="token punctuation">.</span>title }<span class="token punctuation">)</span>
<span class="token keyword">MERGE</span> <span class="token punctuation">(</span>p:Person { name: line<span class="token punctuation">.</span>name }<span class="token punctuation">)</span>
<span class="token keyword">ON</span> <span class="token keyword">CREATE</span> <span class="token keyword">SET</span> p<span class="token punctuation">.</span>born <span class="token operator">=</span> toInteger<span class="token punctuation">(</span>line<span class="token punctuation">.</span>born<span class="token punctuation">)</span>
<span class="token keyword">MERGE</span> <span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:ACTED_IN { roles:split<span class="token punctuation">(</span>line<span class="token punctuation">.</span>roles<span class="token punctuation">,</span> <span class="token string">&apos;;&apos;</span><span class="token punctuation">)</span>}<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">LOAD</span> CSV <span class="token keyword">WITH</span> HEADERS
<span class="token keyword">FROM</span> <span class="token string">&apos;https://neo4j.com/docs/cypher-manual/3.5/csv/query-tuning/directors.csv&apos;</span> <span class="token keyword">AS</span> line
<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>m:Movie { title: line<span class="token punctuation">.</span>title }<span class="token punctuation">)</span>
<span class="token keyword">MERGE</span> <span class="token punctuation">(</span>p:Person { name: line<span class="token punctuation">.</span>name }<span class="token punctuation">)</span>
<span class="token keyword">ON</span> <span class="token keyword">CREATE</span> <span class="token keyword">SET</span> p<span class="token punctuation">.</span>born <span class="token operator">=</span> toInteger<span class="token punctuation">(</span>line<span class="token punctuation">.</span>born<span class="token punctuation">)</span>
<span class="token keyword">MERGE</span> <span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:DIRECTED<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
</pre><div style="page-break-after: always;"></div>
<h5 class="mume-header" id="3-zaimplementowa%C4%87-funkcj%C4%99-wystarczy-wykona%C4%87-jedno-zapytanie-typu-match-where-i-wy%C5%9Bwietli%C4%87-wynik-np-mo%C5%BCna-korzysta%C4%87-z-jdbc-httpsneo4jcomblogneo4j-jdbc-driver-3-0-3-and-3-1-0-released-httpsneo4jcomdeveloperjava_neo4j_for_java_developers">3. Zaimplementowa&#x107; funkcj&#x119; (wystarczy wykona&#x107; jedno zapytanie typu MATCH WHERE i wy&#x15B;wietli&#x107; wynik). Np. mo&#x17C;na korzysta&#x107; z JDBC: <a href="https://neo4j.com/blog/neo4j-jdbc-driver-3-0-3-and-3-1-0-released">https://neo4j.com/blog/neo4j-jdbc-driver-3-0-3-and-3-1-0-released</a>, <a href="https://neo4j.com/developer/java/#_neo4j_for_java_developers">https://neo4j.com/developer/java/#_neo4j_for_java_developers</a></h5>

<p>Wykorzysta&#x142;em Neo4j Python Driver (<a href="https://neo4j.com/developer/python/">https://neo4j.com/developer/python/</a>).</p>
<p>Zaimplementowa&#x142;em dwie funkcje:</p>
<ol>
<li>zwracaj&#x105;c&#x105; tytu&#x142;y film&#xF3;w w kolejno&#x15B;ci chronologicznej (bezargumentow&#x105;),</li>
<li>zwracaj&#x105;c&#x105; imiona i nazwiska aktor&#xF3;w, kt&#xF3;rzy wyst&#x105;pili w filmie o podanym tytule (argument jest przekazywany do zapytania w spos&#xF3;b bezpieczny, czyli uniemo&#x17C;liwiaj&#x105;cy dokonanie ataku Query Injection).</li>
</ol>
<p><strong>requirements.txt</strong></p>
<pre data-role="codeBlock" data-info="txt" class="language-txt"><code>neo4j==1.7.2
neobolt==1.7.9
neotime==1.7.4
</code></pre><p><strong>install.bat</strong></p>
<pre data-role="codeBlock" data-info="bat" class="language-bat"><code>pip install -r requirements.txt
</code></pre><p><strong>main<i></i>.py</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> neo4j <span class="token keyword">import</span> GraphDatabase

uri <span class="token operator">=</span> <span class="token string">&apos;bolt://localhost:7687&apos;</span>
user <span class="token operator">=</span> <span class="token string">&apos;neo4j&apos;</span>
password <span class="token operator">=</span> <span class="token string">&apos;lab5&apos;</span>
driver <span class="token operator">=</span> GraphDatabase<span class="token punctuation">.</span>driver<span class="token punctuation">(</span>uri<span class="token punctuation">,</span> auth<span class="token operator">=</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">list_movies</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> tx<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">&quot;MATCH (m:Movie) &quot;</span>
                    <span class="token string">&quot;RETURN m.title AS title, m.released AS year &quot;</span>
                    <span class="token string">&quot;ORDER BY m.released&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> record <span class="token keyword">in</span> result<span class="token punctuation">:</span>
        title<span class="token punctuation">,</span> year <span class="token operator">=</span> record<span class="token punctuation">[</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> record<span class="token punctuation">[</span><span class="token string">&apos;year&apos;</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&apos;</span><span class="token interpolation"><span class="token punctuation">{</span>title<span class="token punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token punctuation">{</span>year<span class="token punctuation">}</span></span><span class="token string">)&apos;</span></span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">list_movie_actors</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> movie_title<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> tx<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">&quot;MATCH (p:Person)-[:ACTED_IN]-&gt;(m:Movie) &quot;</span>
                    <span class="token string">&quot;WHERE m.title = $title &quot;</span>
                    <span class="token string">&quot;RETURN p.name AS name&quot;</span><span class="token punctuation">,</span> title<span class="token operator">=</span>movie_title<span class="token punctuation">)</span>
    <span class="token keyword">for</span> record <span class="token keyword">in</span> result<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>record<span class="token punctuation">[</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&apos;__main__&apos;</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> driver<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
        session<span class="token punctuation">.</span>read_transaction<span class="token punctuation">(</span>list_movies<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        session<span class="token punctuation">.</span>read_transaction<span class="token punctuation">(</span>list_movie_actors<span class="token punctuation">,</span> movie_title<span class="token operator">=</span><span class="token string">&apos;The Matrix&apos;</span><span class="token punctuation">)</span>
</pre><p>Wynik wykonania powy&#x17C;szego programu:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Something&apos;s Gotta Give (1975)
One Flew Over the Cuckoo&apos;s Nest (1975)
Top Gun (1986)
Joe Versus the Volcano (1990)
A Few Good Men (1992)
Hoffa (1992)
A League of Their Own (1992)
Unforgiven (1992)
Sleepless in Seattle (1993)
Johnny Mnemonic (1995)
Apollo 13 (1995)
Stand By Me (1995)
That Thing You Do (1996)
Twister (1996)
The Birdcage (1996)
The Devil&apos;s Advocate (1997)
As Good as It Gets (1997)
What Dreams May Come (1998)
When Harry Met Sally (1998)
You&apos;ve Got Mail (1998)
The Matrix (1999)
The Green Mile (1999)
Snow Falling on Cedars (1999)
Bicentennial Man (1999)
The Replacements (2000)
Jerry Maguire (2000)
Cast Away (2000)
The Matrix Revolutions (2003)
The Matrix Reloaded (2003)
The Polar Express (2004)
V for Vendetta (2006)
RescueDawn (2006)
The Da Vinci Code (2006)
Charlie Wilson&apos;s War (2007)
Speed Racer (2008)
Frost/Nixon (2008)
Ninja Assassin (2009)
Cloud Atlas (2012)

Emil Eifrem
Hugo Weaving
Laurence Fishburne
Carrie-Anne Moss
Keanu Reeves
</code></pre><div style="page-break-after: always;"></div>
<h5 class="mume-header" id="4-stworzy%C4%87-kilka-nowych-w%C4%99z%C5%82y-reprezentuj%C4%85cych-film-oraz-aktor%C3%B3w-w-nim-wyst%C4%99puj%C4%85cych-nast%C4%99pnie-stworzy%C4%87-relacje-ich-%C5%82%C4%85cz%C4%85ce-np-acted_in">4. Stworzy&#x107; kilka nowych w&#x119;z&#x142;y reprezentuj&#x105;cych film oraz aktor&#xF3;w w nim wyst&#x119;puj&#x105;cych, nast&#x119;pnie stworzy&#x107; relacje ich &#x142;&#x105;cz&#x105;ce (np. ACTED_IN).</h5>

<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span>
<span class="token punctuation">(</span>:Movie {title: <span class="token string">&quot;Back to the Future&quot;</span><span class="token punctuation">,</span> released: <span class="token number">1985</span><span class="token punctuation">,</span>
  tagline: <span class="token string">&quot;Marty McFly just broke the time barrier. He&apos;s only got one week to get it fixed.&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span>:Movie {title: <span class="token string">&quot;Back to the Future Part II&quot;</span><span class="token punctuation">,</span> released: <span class="token number">1989</span><span class="token punctuation">,</span>
  tagline: <span class="token string">&quot;Roads? Where we&apos;re going, we don&apos;t need roads!&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span>:Movie {title: <span class="token string">&quot;Back to the Future Part III&quot;</span><span class="token punctuation">,</span> released: <span class="token number">1990</span><span class="token punctuation">,</span>
  tagline: <span class="token string">&quot;They&apos;ve saved the best trip for last... But this time they may have gone too far.&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Michael J. Fox&quot;</span><span class="token punctuation">,</span> born: <span class="token number">1961</span>}<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Christopher Lloyd&quot;</span><span class="token punctuation">,</span> born: <span class="token number">1938</span>}<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Lea Thompson&quot;</span><span class="token punctuation">,</span> born: <span class="token number">1961</span>}<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Crispin Glover&quot;</span><span class="token punctuation">,</span> born: <span class="token number">1964</span>}<span class="token punctuation">)</span><span class="token punctuation">,</span>       
<span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Thomas F. Wilson&quot;</span><span class="token punctuation">,</span> born: <span class="token number">1959</span>}<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Mary Steenburgen&quot;</span><span class="token punctuation">,</span> born: <span class="token number">1953</span>}<span class="token punctuation">)</span>

<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>a:Person {name: <span class="token string">&quot;Robert Zemeckis&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>b:Movie<span class="token punctuation">)</span>
<span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>title STARTS <span class="token keyword">WITH</span> <span class="token string">&quot;Back to the Future&quot;</span>
<span class="token keyword">CREATE</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:DIRECTED<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>

<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>a:Person {name: <span class="token string">&quot;Michael J. Fox&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>b:Movie<span class="token punctuation">)</span>
<span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>title STARTS <span class="token keyword">WITH</span> <span class="token string">&quot;Back to the Future&quot;</span>
<span class="token keyword">CREATE</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:ACTED_IN {roles: <span class="token string">&quot;Marty McFly&quot;</span>}<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>

<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>a:Person {name: <span class="token string">&quot;Christopher Lloyd&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>b:Movie<span class="token punctuation">)</span>
<span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>title STARTS <span class="token keyword">WITH</span> <span class="token string">&quot;Back to the Future&quot;</span>
<span class="token keyword">CREATE</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:ACTED_IN {roles: <span class="token string">&quot;Dr. Emmett Brown&quot;</span>}<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>

<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>a:Person {name: <span class="token string">&quot;Lea Thompson&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>b:Movie<span class="token punctuation">)</span>
<span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>title STARTS <span class="token keyword">WITH</span> <span class="token string">&quot;Back to the Future&quot;</span>
<span class="token keyword">CREATE</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:ACTED_IN {roles: <span class="token string">&quot;Lorraine Baines&quot;</span>}<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>

<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>a:Person {name: <span class="token string">&quot;Crispin Glover&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>b:Movie {title: <span class="token string">&quot;Back to the Future&quot;</span>}<span class="token punctuation">)</span>
<span class="token keyword">CREATE</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:ACTED_IN {roles: <span class="token string">&quot;George McFly&quot;</span>}<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>

<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>a:Person {name: <span class="token string">&quot;Thomas F. Wilson&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>b:Movie<span class="token punctuation">)</span>
<span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>title STARTS <span class="token keyword">WITH</span> <span class="token string">&quot;Back to the Future&quot;</span>
<span class="token keyword">CREATE</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:ACTED_IN {roles: <span class="token string">&quot;Biff Tannen&quot;</span>}<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>

<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>a:Person {name: <span class="token string">&quot;Mary Steenburgen&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>b:Movie {title: <span class="token string">&quot;Back to the Future Part III&quot;</span>}<span class="token punctuation">)</span>
<span class="token keyword">CREATE</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:ACTED_IN {roles: <span class="token string">&quot;Clara Clayton&quot;</span>}<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
</pre><div style="page-break-after: always;"></div>
<p>Sprawdzenie:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">MATCH</span> <span class="token punctuation">(</span>m:Movie<span class="token punctuation">)</span>
<span class="token keyword">WHERE</span> m<span class="token punctuation">.</span>title STARTS <span class="token keyword">WITH</span> <span class="token string">&quot;Back to the Future&quot;</span>
<span class="token keyword">RETURN</span> m
</pre><img src="4/screen.png" width="50%">
<div style="page-break-after: always;"></div>
<h5 class="mume-header" id="5-doda%C4%87-zapytaniem-nowe-w%C5%82a%C5%9Bciwo%C5%9Bci-nowo-dodanych-w%C4%99z%C5%82%C3%B3w-reprezentuj%C4%85cych-aktor-np-birthdate-oraz-birthplace">5. Doda&#x107; zapytaniem nowe w&#x142;a&#x15B;ciwo&#x15B;ci nowo dodanych w&#x119;z&#x142;&#xF3;w reprezentuj&#x105;cych aktor (np. birthdate oraz birthplace).</h5>

<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">MATCH</span> <span class="token punctuation">(</span>p:Person {name: <span class="token string">&quot;Michael J. Fox&quot;</span>}<span class="token punctuation">)</span>
<span class="token keyword">SET</span> p<span class="token punctuation">.</span>birthdate <span class="token operator">=</span> <span class="token keyword">date</span><span class="token punctuation">(</span><span class="token string">&quot;1961-06-09&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>birthplace <span class="token operator">=</span> <span class="token string">&quot;Edmonton&quot;</span>

<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>p:Person {name: <span class="token string">&quot;Christopher Lloyd&quot;</span>}<span class="token punctuation">)</span>
<span class="token keyword">SET</span> p<span class="token punctuation">.</span>birthdate <span class="token operator">=</span> <span class="token keyword">date</span><span class="token punctuation">(</span><span class="token string">&quot;1938-10-22&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>birthplace <span class="token operator">=</span> <span class="token string">&quot;Stamford&quot;</span>

<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>p:Person {name: <span class="token string">&quot;Lea Thompson&quot;</span>}<span class="token punctuation">)</span>
<span class="token keyword">SET</span> p<span class="token punctuation">.</span>birthdate <span class="token operator">=</span> <span class="token keyword">date</span><span class="token punctuation">(</span><span class="token string">&quot;1961-05-31&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>birthplace <span class="token operator">=</span> <span class="token string">&quot;Rochester&quot;</span>

<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>p:Person {name: <span class="token string">&quot;Crispin Glover&quot;</span>}<span class="token punctuation">)</span>
<span class="token keyword">SET</span> p<span class="token punctuation">.</span>birthdate <span class="token operator">=</span> <span class="token keyword">date</span><span class="token punctuation">(</span><span class="token string">&quot;1964-04-20&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>birthplace <span class="token operator">=</span> <span class="token string">&quot;New York&quot;</span>

<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>p:Person {name: <span class="token string">&quot;Thomas F. Wilson&quot;</span>}<span class="token punctuation">)</span>
<span class="token keyword">SET</span> p<span class="token punctuation">.</span>birthdate <span class="token operator">=</span> <span class="token keyword">date</span><span class="token punctuation">(</span><span class="token string">&quot;1959-04-15&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>birthplace <span class="token operator">=</span> <span class="token string">&quot;Philadelphia&quot;</span>

<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>p:Person {name: <span class="token string">&quot;Mary Steenburgen&quot;</span>}<span class="token punctuation">)</span>
<span class="token keyword">SET</span> p<span class="token punctuation">.</span>birthdate <span class="token operator">=</span> <span class="token keyword">date</span><span class="token punctuation">(</span><span class="token string">&quot;1953-02-08&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>birthplace <span class="token operator">=</span> <span class="token string">&quot;Newport&quot;</span>
</pre><p>Sprawdzenie:</p>
<p><img src="5/screen.png" alt></p>
<br>
<br>
<h5 class="mume-header" id="6-u%C5%82o%C5%BCy%C4%87-zapytanie-kt%C3%B3re-zmieni-warto%C5%9B%C4%87-atrybutu-w%C4%99z%C5%82%C3%B3w-danego-typu-je%C5%BCeli-innych-atrybut-w%C4%99z%C5%82a-spe%C5%82nia-zadane-kryterium">6. U&#x142;o&#x17C;y&#x107; zapytanie, kt&#xF3;re zmieni warto&#x15B;&#x107; atrybutu w&#x119;z&#x142;&#xF3;w danego typu, je&#x17C;eli innych atrybut w&#x119;z&#x142;a spe&#x142;nia zadane kryterium.</h5>

<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">MATCH</span> <span class="token punctuation">(</span>m:Movie<span class="token punctuation">)</span>
<span class="token keyword">WHERE</span> m<span class="token punctuation">.</span>released <span class="token operator">&lt;</span> <span class="token number">1998</span>
<span class="token keyword">SET</span> m<span class="token punctuation">.</span>old <span class="token operator">=</span> <span class="token boolean">true</span>
</pre><div style="page-break-after: always;"></div>
<h5 class="mume-header" id="7-zapytanie-o-aktor%C3%B3w-kt%C3%B3rzy-grali-w-co-najmniej-2-filmach-u%C5%BCy%C4%87-collect-i-length-i-policzy%C4%87-%C5%9Bredni%C4%85-wyst%C4%85pie%C5%84-w-filmach-dla-grupy-aktor%C3%B3w-kt%C3%B3rzy-wyst%C4%85pili-w-co-najmniej-3-filmach">7. Zapytanie o aktor&#xF3;w kt&#xF3;rzy grali w co najmniej 2 filmach (u&#x17C;y&#x107; collect i length) i policzy&#x107; &#x15B;redni&#x105; wyst&#x105;pie&#x144; w filmach dla grupy aktor&#xF3;w, kt&#xF3;rzy wyst&#x105;pili w co najmniej 3 filmach.</h5>

<p><strong>Aktorzy, kt&#xF3;rzy grali w co najmniej 2 filmach:</strong></p>
<p>Rozwi&#x105;zanie wykorzystuj&#x105;ce <code>collect</code> i <code>length</code>:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">MATCH</span> <span class="token punctuation">(</span>p:Person<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:ACTED_IN<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>m:Movie<span class="token punctuation">)</span>
<span class="token keyword">WITH</span> p<span class="token punctuation">,</span> collect<span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token keyword">as</span> movies
<span class="token keyword">WHERE</span> length<span class="token punctuation">(</span>movies<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">2</span>
<span class="token keyword">RETURN</span> p
</pre><p>Alternatywne rozwi&#x105;zanie wykorzystuj&#x105;ce <code>count</code>:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">MATCH</span> <span class="token punctuation">(</span>p:Person<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:ACTED_IN<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>m:Movie<span class="token punctuation">)</span>
<span class="token keyword">WITH</span> p<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token keyword">as</span> number_of_movies
<span class="token keyword">WHERE</span> number_of_movies <span class="token operator">&gt;=</span> <span class="token number">2</span>
<span class="token keyword">RETURN</span> p
</pre><p><strong>&#x15A;rednia wyst&#x105;pie&#x144; w filmach dla aktor&#xF3;w, kt&#xF3;rzy wyst&#x105;pili w co najmniej 3 filmach:</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">MATCH</span> <span class="token punctuation">(</span>p:Person<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:ACTED_IN<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>m:Movie<span class="token punctuation">)</span>
<span class="token keyword">WITH</span> p<span class="token punctuation">,</span> collect<span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token keyword">AS</span> movies
<span class="token keyword">WITH</span> length<span class="token punctuation">(</span>movies<span class="token punctuation">)</span> <span class="token keyword">AS</span> number_of_movies
<span class="token keyword">WHERE</span> number_of_movies <span class="token operator">&gt;=</span> <span class="token number">3</span>
<span class="token keyword">RETURN</span> <span class="token function">avg</span><span class="token punctuation">(</span>number_of_movies<span class="token punctuation">)</span>
</pre><p>Wynik: 4.05263157894737</p>
<div style="page-break-after: always;"></div>
<h5 class="mume-header" id="9-zmieni%C4%87-warto%C5%9B%C4%87-wybranego-atrybutu-w-w%C4%99z%C5%82ach-na-%C5%9Bcie%C5%BCce-pomi%C4%99dzy-dwoma-podanymi-w%C4%99z%C5%82ami">9. Zmieni&#x107; warto&#x15B;&#x107; wybranego atrybutu w w&#x119;z&#x142;ach na &#x15B;cie&#x17C;ce pomi&#x119;dzy dwoma podanymi w&#x119;z&#x142;ami.</h5>

<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">MATCH</span> path <span class="token operator">=</span> shortestPath<span class="token punctuation">(</span><span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Tom Hanks&quot;</span>}<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Demi Moore&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">)</span>
FOREACH <span class="token punctuation">(</span>node <span class="token operator">IN</span> nodes<span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">SET</span> node<span class="token punctuation">.</span>marked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</pre><p>Sprawdzenie:<br>
<img src="9/screen.png" alt></p>
<div style="page-break-after: always;"></div>
<h5 class="mume-header" id="10-wy%C5%9Bwietli%C4%87-w%C4%99z%C5%82y-kt%C3%B3re-znajduj%C4%85-si%C4%99-na-2-miejscu-na-%C5%9Bcie%C5%BCkach-o-d%C5%82ugo%C5%9Bci-4-pomi%C4%99dzy-dwoma-wybranymi-w%C4%99z%C5%82ami">10. Wy&#x15B;wietli&#x107; w&#x119;z&#x142;y, kt&#xF3;re znajduj&#x105; si&#x119; na 2 miejscu na &#x15B;cie&#x17C;kach o d&#x142;ugo&#x15B;ci 4 pomi&#x119;dzy dwoma wybranymi w&#x119;z&#x142;ami.</h5>

<p>Z wykorzystaniem <code>nodes(path)</code>, w&#x119;z&#x142;y na &#x15B;cie&#x17C;ce liczone od 0:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">MATCH</span> path <span class="token operator">=</span> <span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Tom Hanks&quot;</span>}<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:ACTED_IN<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Demi Moore&quot;</span>}<span class="token punctuation">)</span>
<span class="token keyword">RETURN</span> nodes<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
</pre><p>Z wykorzystaniem <code>nodes(path)</code>, w&#x119;z&#x142;y na &#x15B;cie&#x17C;ce liczone od 1:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">MATCH</span> path <span class="token operator">=</span> <span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Tom Hanks&quot;</span>}<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>:ACTED_IN<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Demi Moore&quot;</span>}<span class="token punctuation">)</span>
<span class="token keyword">RETURN</span> nodes<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
</pre><p>Z wykorzystaniem <code>startNode(relationship)</code>, w&#x119;z&#x142;y na &#x15B;cie&#x17C;ce liczone od 0:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">MATCH</span> <span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Tom Hanks&quot;</span>}<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>rels:ACTED_IN<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Demi Moore&quot;</span>}<span class="token punctuation">)</span>
<span class="token keyword">RETURN</span> startNode<span class="token punctuation">(</span>rels<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</pre><p>Z wykorzystaniem <code>startNode(relationship)</code>, w&#x119;z&#x142;y na &#x15B;cie&#x17C;ce liczone od 1:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">MATCH</span> <span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Tom Hanks&quot;</span>}<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>rels:ACTED_IN<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Demi Moore&quot;</span>}<span class="token punctuation">)</span>
<span class="token keyword">RETURN</span> startNode<span class="token punctuation">(</span>rels<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</pre><div style="page-break-after: always;"></div>
<h5 class="mume-header" id="11-por%C3%B3wna%C4%87-czas-wykonania-zapytania-o-wybranego-aktora-bez-oraz-z-indeksem-w-bazie-na%C5%82o%C5%BConym-na-atrybut-name-drop-index-i-create-index-oraz-u%C5%BCy%C4%87-komendy-profileexplain">11. Por&#xF3;wna&#x107; czas wykonania zapytania o wybranego aktora bez oraz z indeksem w bazie na&#x142;o&#x17C;onym na atrybut name (DROP INDEX i CREATE INDEX oraz u&#x17C;y&#x107; komendy PROFILE/EXPLAIN).</h5>

<pre data-role="codeBlock" data-info="sql" class="language-sql">PROFILE
<span class="token keyword">MATCH</span> <span class="token punctuation">(</span>p:Person {name: <span class="token string">&quot;Michael J. Fox&quot;</span>}<span class="token punctuation">)</span>
<span class="token keyword">RETURN</span> p
</pre><p>Przed utworzeniem indeksu:</p>
<p><img src="11/before.png" alt><br>
<strong>Czas wykonania: 23 ms</strong></p>
<p>Kolejne wykonanie zapytania zajmuje znacznie mniej czasu ni&#x17C; za pierwszym razem. Podejrzewam, &#x17C;e wyniki zapyta&#x144; lub rezultaty niekt&#xF3;rych etap&#xF3;w planu wykonania s&#x105; zapisywanie w pami&#x119;ci cache.</p>
<p>Utworzenie indeksu:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> <span class="token keyword">ON</span> :Person<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
</pre><p>Po utworzeniu indeksu:</p>
<p><img src="11/after.png" alt><br>
<strong>Czas wykonania: 1 ms</strong></p>
<div style="page-break-after: always;"></div>
<h5 class="mume-header" id="12-spr%C3%B3bowa%C4%87-dokona%C4%87-optymalizacji-wybranych-dw%C3%B3ch-zapyta%C5%84-z-poprzednich-zada%C5%84-za%C5%82%C4%85czy%C4%87-przyk%C5%82ady-w-sprawozdaniu">12.  Spr&#xF3;bowa&#x107; dokona&#x107; optymalizacji wybranych dw&#xF3;ch zapyta&#x144; z poprzednich zada&#x144; (za&#x142;&#x105;czy&#x107; przyk&#x142;ady w sprawozdaniu).</h5>

<p><strong>Zapytanie z punktu 6.</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">MATCH</span> <span class="token punctuation">(</span>m:Movie<span class="token punctuation">)</span>
<span class="token keyword">WHERE</span> m<span class="token punctuation">.</span>released <span class="token operator">&lt;</span> <span class="token number">1998</span>
<span class="token keyword">SET</span> m<span class="token punctuation">.</span>old <span class="token operator">=</span> <span class="token boolean">true</span>
</pre><p>Czas wykonania zapytania przed utworzeniem indeksu: 37 ms</p>
<p>Utworzenie indeksu:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> <span class="token keyword">ON</span> :Movie<span class="token punctuation">(</span>released<span class="token punctuation">)</span>
</pre><p>Czas wykonania zapytania po utworzeniu indeksu: 7 ms</p>
<p><strong>Zapytanie z punktu 9.</strong></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">MATCH</span> path <span class="token operator">=</span> shortestPath<span class="token punctuation">(</span><span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Tom Hanks&quot;</span>}<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Demi Moore&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">)</span>
FOREACH <span class="token punctuation">(</span>node <span class="token operator">IN</span> nodes<span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">SET</span> node<span class="token punctuation">.</span>marked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</pre><p>Je&#x15B;li przechowywany w bazie danych graf by&#x142;by du&#x17C;ych rozmiar&#xF3;w, wskazane by&#x142;oby ograniczenie d&#x142;ugo&#x15B;ci poszukiwanej &#x15B;cie&#x17C;ki. Zamiast <code>[*]</code> nale&#x17C;y wi&#x119;c zastosowa&#x107; przyk&#x142;adowo <code>[*..6]</code>, kt&#xF3;re ograniczy obszar przeszukiwania grafu.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">MATCH</span> path <span class="token operator">=</span> shortestPath<span class="token punctuation">(</span><span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Tom Hanks&quot;</span>}<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token number">.6</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">(</span>:Person {name: <span class="token string">&quot;Demi Moore&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">)</span>
FOREACH <span class="token punctuation">(</span>node <span class="token operator">IN</span> nodes<span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">SET</span> node<span class="token punctuation">.</span>marked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</pre><div style="page-break-after: always;"></div>
<h5 class="mume-header" id="13-napisa%C4%87-kod-kt%C3%B3re-wygeneruje-drzewo-rozpinaj%C4%85ce-z-bazy-z-poziomu-javy-lub-pythona-nie-musi-by%C4%87-minimalne">13.  Napisa&#x107; kod, kt&#xF3;re wygeneruje drzewo rozpinaj&#x105;ce z bazy (z poziomu javy lub pythona, nie musi by&#x107; minimalne)</h5>

<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> neo4j <span class="token keyword">import</span> GraphDatabase

uri <span class="token operator">=</span> <span class="token string">&apos;bolt://localhost:7687&apos;</span>
user <span class="token operator">=</span> <span class="token string">&apos;neo4j&apos;</span>
password <span class="token operator">=</span> <span class="token string">&apos;lab5&apos;</span>
driver <span class="token operator">=</span> GraphDatabase<span class="token punctuation">.</span>driver<span class="token punctuation">(</span>uri<span class="token punctuation">,</span> auth<span class="token operator">=</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">make_spanning_tree</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">:</span>
    nodes <span class="token operator">=</span> <span class="token punctuation">{</span>
        record<span class="token punctuation">[</span><span class="token string">&apos;id&apos;</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">&apos;name&apos;</span><span class="token punctuation">:</span> record<span class="token punctuation">[</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># person name or movie title from database</span>
            <span class="token string">&apos;graph_neighbours&apos;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># list of connected nodes from database</span>
            <span class="token string">&apos;dfs_visited&apos;</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>    <span class="token comment"># flag for DFS algorithm</span>
            <span class="token string">&apos;tree_children&apos;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>      <span class="token comment"># list of spanning tree edges</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> record <span class="token keyword">in</span> tx<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">&quot;MATCH (p:Person) RETURN ID(p) AS id, p.name AS name &quot;</span>
                             <span class="token string">&quot;UNION ALL MATCH (m:Movie) RETURN ID(m) AS id, m.title AS name &quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    result <span class="token operator">=</span> tx<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">&quot;MATCH (p:Person)-[:ACTED_IN|:DIRECTED]-&gt;(m:Movie)&quot;</span>
                    <span class="token string">&quot;RETURN ID(p) AS person_id, ID(m) AS movie_id&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> record <span class="token keyword">in</span> result<span class="token punctuation">:</span>
        person_id<span class="token punctuation">,</span> movie_id <span class="token operator">=</span> record<span class="token punctuation">[</span><span class="token string">&apos;person_id&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> record<span class="token punctuation">[</span><span class="token string">&apos;movie_id&apos;</span><span class="token punctuation">]</span>
        nodes<span class="token punctuation">[</span>person_id<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;graph_neighbours&apos;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>movie_id<span class="token punctuation">)</span>
        nodes<span class="token punctuation">[</span>movie_id<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;graph_neighbours&apos;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>person_id<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">dfs</span><span class="token punctuation">(</span>this_id<span class="token punctuation">,</span> prev_id<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        nodes<span class="token punctuation">[</span>this_id<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;dfs_visited&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">if</span> prev_id <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            nodes<span class="token punctuation">[</span>prev_id<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;tree_children&apos;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>this_id<span class="token punctuation">)</span>
        <span class="token keyword">for</span> next_id <span class="token keyword">in</span> nodes<span class="token punctuation">[</span>this_id<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;graph_neighbours&apos;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> nodes<span class="token punctuation">[</span>next_id<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;dfs_visited&apos;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                dfs<span class="token punctuation">(</span>next_id<span class="token punctuation">,</span> this_id<span class="token punctuation">)</span>

    start<span class="token punctuation">,</span> <span class="token operator">*</span>_ <span class="token operator">=</span> nodes<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># take any node ID</span>
    dfs<span class="token punctuation">(</span>start<span class="token punctuation">)</span>

    nodes_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span>
    spanning_tree_edges_count <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> node<span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>node<span class="token punctuation">[</span><span class="token string">&apos;tree_children&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nodes<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> nodes_count <span class="token operator">==</span> spanning_tree_edges_count<span class="token operator">+</span><span class="token number">1</span>  <span class="token comment"># check tree condition</span>

    <span class="token keyword">def</span> <span class="token function">print_tree</span><span class="token punctuation">(</span>node_id<span class="token punctuation">,</span> left<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos; &apos;</span> <span class="token operator">*</span> left <span class="token operator">+</span> nodes<span class="token punctuation">[</span>node_id<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> child_id <span class="token keyword">in</span> nodes<span class="token punctuation">[</span>node_id<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;tree_children&apos;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            print_tree<span class="token punctuation">(</span>child_id<span class="token punctuation">,</span> left<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
    print_tree<span class="token punctuation">(</span>start<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&apos;__main__&apos;</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> driver<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
        session<span class="token punctuation">.</span>read_transaction<span class="token punctuation">(</span>make_spanning_tree<span class="token punctuation">)</span>
</pre><div style="page-break-after: always;"></div>
<p>Wynik wykonania programu (dla czytelno&#x15B;ci wyci&#x105;&#x142;em &#x15B;rodkowy fragment):</p>
<pre data-role="codeBlock" data-info class="language-"><code>Keanu Reeves
 The Replacements        
  Howard Deutch
  Brooke Langton
  Orlando Jones
  Gene Hackman
   The Birdcage
    Mike Nichols
     Charlie Wilson&apos;s War
      Julia Roberts      
      Tom Hanks
       Cloud Atlas       
        Tom Tykwer       
        Lana Wachowski   
         The Matrix Revolutions
          Andy Wachowski
           The Matrix Reloaded
            Hugo Weaving
             The Matrix
              Emil Eifrem
              Laurence Fishburne
              Carrie-Anne Moss
             V for Vendetta
                (...)
                  Matthew Fox
                  John Goodman
                  Emile Hirsch
                  Ben Miles
                  Christina Ricci
                  Susan Sarandon
              Stephen Rea
              John Hurt
              Natalie Portman
        Jim Broadbent
        Halle Berry
       That Thing You Do
        Liv Tyler
        Charlize Theron
         The Devil&apos;s Advocate
          Taylor Hackford
          Al Pacino
   Unforgiven
    Clint Eastwood
    Richard Harris
 Johnny Mnemonic
  Robert Longo
  Dina Meyer
  Ice-T
  Takeshi Kitano
</code></pre>
      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>